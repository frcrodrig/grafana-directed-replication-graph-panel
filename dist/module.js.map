{"version":3,"sources":["../src/module.js"],"names":["config","MetricsPanelCtrl","angular","DataSet","Network","nodes","edges","GraphCtrl","$scope","$injector","$rootScope","$http","rootScope","scope","timeSrv","get","templateSrv","events","on","onDataReceived","bind","data","options","shape","color","background","border","font","length","arrows","layout","randomSeed","autoResize","height","width","dataList","series","map","seriesHandler","data_edge","label","data_node","i","target","indexOf","target_id","substring","query_value","datapoints","id","value","updated","_data","add","update","subtraction","parseInt","split","opacity","e","console","log","node","remove","edge","seriesData","templateUrl","module","directive","restrict","transclude","link","element","attr","networkEvents","network","$watch","destroy","forEach","callback","event","String","onload","isFunction","$watchCollection","setOptions","factory"],"mappings":"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","file":"module.js","sourcesContent":["import config from 'app/core/config';\nimport {\n    MetricsPanelCtrl\n} from 'app/plugins/sdk';\nimport angular from 'angular';\nimport {\n    DataSet,\n    Network\n} from './external/vis.min';\n\nvar nodes = [];\nvar edges = [];\nexport class GraphCtrl extends MetricsPanelCtrl {\n    constructor($scope, $injector, $rootScope, $http) {\n        super($scope, $injector);\n        this.rootScope = $rootScope;\n        this.scope = $scope;\n        this.timeSrv = $injector.get('timeSrv');\n        this.templateSrv = $injector.get('templateSrv');\n        this.events.on('data-received', this.onDataReceived.bind(this));\n\n        nodes = new DataSet(nodes);\n        edges = new DataSet(edges);\n        var data = {\n            nodes: nodes,\n            edges: edges\n        };\n        var options = {\n            nodes: {\n                shape: 'dot',\n                color: {\n                    background: \"#ffd800\",\n                    border: \"#ff6400\"\n                },\n                font: {\n                    color: \"#fff\"\n                }\n            },\n            edges: {\n                length: 400,\n                arrows: 'to',\n                color: {\n                    color: '#ff6400'\n                }\n            },\n            layout: {\n                randomSeed: 528861\n            },\n            autoResize: true,\n            height: '100%',\n            width: '100%'\n        };\n        $scope.data = data;\n        $scope.options = options;\n    }\n\n    onDataReceived(dataList) {\n        this.series = dataList.map(this.seriesHandler.bind(this));\n        var data_edge = {\n            label: \"\"\n        };\n        var data_node = {};\n\n        for (var i = 0; i < this.series.length; i++) {\n            try{\n            data_edge = {\n                label: \"\"\n            };\n            data_node = {};\n            if (this.series[i].target.indexOf(\"#\") != -1) {\n                var target_id = this.series[i].target.substring(1, this.series[i].target.length);\n                var query_value = this.series[i].datapoints[this.series[i].datapoints.length - 1][0];\n                data_node = {\n                    id: target_id,\n                    value: query_value,\n                    label: target_id + \"\\n\" + query_value,\n                    updated: 1\n                }\n                if (!(target_id in nodes._data)) {\n                    nodes.add(data_node);\n                } else {\n                    nodes.update(data_node);\n                }\n            }\n\n            if (this.series[i].target.indexOf(\"=\") != -1) {\n                if (this.series[i].target.indexOf(\"*\") != -1) {\n                    this.series[i].target = this.series[i].target.substring(1, this.series[i].target.length)\n                    var subtraction = 0;\n\n                    if (this.series[i].target.indexOf(\"-\") != -1) {\n                        subtraction = this.series[parseInt(this.series[i].target.split(\"-\")[1], 10)].datapoints[this.series[i].datapoints.length - 1][0];\n                        this.series[i].target = this.series[i].target.split(\"-\")[0];\n\n                    }\n\n                    if (this.series[i].target.indexOf(\"+\") != -1) {\n                        this.series[i].target = this.series[i].target.substring(1, this.series[i].target.length);\n                        data_edge['label'] = edges.get(this.series[i].target).label + \" / \" + (this.series[i].datapoints[this.series[i].datapoints.length - 1][0] - subtraction);\n                    } else {\n                        data_edge['label'] = this.series[i].datapoints[this.series[i].datapoints.length - 1][0] - subtraction;\n                    }\n                }\n                data_edge['id'] = this.series[i].target;\n                data_edge['from'] = this.series[i].target.split(\"=\")[0];\n                data_edge['color'] = {\n                    color: '5a910a',\n                    opacity: this.series[i].datapoints[this.series[i].datapoints.length - 1][0] / 100\n                };\n                data_edge['to'] = this.series[i].target.split(\"=\")[1];\n                data_edge['updated'] = 1;\n                if (!(this.series[i].target in edges._data)) {\n                    edges.add(data_edge);\n                } else {\n                    edges.update(data_edge);\n                }\n\n            }\n                    }catch(e) {\n            console.log(e);\n            continue \n        }\n\n        }\n        for (var node in nodes._data) {\n            if (!(nodes._data[node].updated)) {\n                nodes.remove({\n                    id: node\n                });\n            } else {\n                nodes._data[node].updated = !nodes._data[node].updated;\n            }\n        }\n        for (var edge in edges._data) {\n            if (!(edges._data[edge].updated)) {\n                edges.remove({\n                    id: edge\n                });\n            } else {\n                edges._data[edge].updated = !edges._data[edge].updated;\n            }\n\n        } \n    }\n    seriesHandler(seriesData) {\n        var series = seriesData;\n        return series;\n    }\n\n}\n\n\n\nGraphCtrl.templateUrl = 'module.html';\n\nangular.module('grafana.directives')\n    .directive('visNetwork', function() {\n        return {\n            restrict: 'EA',\n            transclude: false,\n            scope: {\n                data: '=',\n                options: '=',\n                events: '='\n            },\n            link: function(scope, element, attr) {\n                var networkEvents = [\n                    'click',\n                    'doubleClick',\n                    'oncontext',\n                    'hold',\n                    'release',\n                    'selectNode',\n                    'selectEdge',\n                    'deselectNode',\n                    'deselectEdge',\n                    'dragStart',\n                    'dragging',\n                    'dragEnd',\n                    'hoverNode',\n                    'blurNode',\n                    'zoom',\n                    'showPopup',\n                    'hidePopup',\n                    'startStabilizing',\n                    'stabilizationProgress',\n                    'stabilizationIterationsDone',\n                    'stabilized',\n                    'resize',\n                    'initRedraw',\n                    'beforeDrawing',\n                    'afterDrawing',\n                    'animationFinished'\n\n                ];\n\n                var network = null;\n\n                scope.$watch('data', function() {\n                    // Sanity check\n                    if (scope.data == null) {\n                        return;\n                    }\n\n                    // If we've actually changed the data set, then recreate the graph\n                    // We can always update the data by adding more data to the existing data set\n                    if (network != null) {\n                        network.destroy();\n                    }\n\n                    // Create the graph2d object\n                    network = new Network(element[0], scope.data, scope.options);\n\n                    // Attach an event handler if defined\n                    angular.forEach(scope.events, function(callback, event) {\n                        if (networkEvents.indexOf(String(event)) >= 0) {\n                            network.on(event, callback);\n                        }\n                    });\n\n                    // onLoad callback\n                    if (scope.events != null && scope.events.onload != null &&\n                        angular.isFunction(scope.events.onload)) {\n                        scope.events.onload(network);\n                    }\n                });\n\n                scope.$watchCollection('options', function(options) {\n                    if (network == null) {\n                        return;\n                    }\n                    network.setOptions(options);\n                });\n            }\n        };\n    });\nangular.module('grafana.services')\n    .factory('VisDataSet', function() {\n        'use strict';\n        return function(data, options) {\n            // Create the new dataSets\n            return new DataSet(data, options);\n        };\n    })\n\nexport {\n    GraphCtrl as PanelCtrl\n};"]}