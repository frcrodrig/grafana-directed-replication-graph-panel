{"version":3,"sources":["../src/module.js"],"names":["config","MetricsPanelCtrl","angular","DataSet","Network","nodes","edges","GraphCtrl","$scope","$injector","$rootScope","$http","rootScope","scope","timeSrv","get","templateSrv","events","on","onDataReceived","bind","data","options","shape","color","background","border","font","length","arrows","layout","randomSeed","dataList","series","map","seriesHandler","data_edge","label","data_node","console","log","i","target","indexOf","target_id","substring","query_value","datapoints","id","value","updated","_data","add","update","subtraction","parseInt","split","opacity","node","remove","edge","seriesData","templateUrl","module","directive","restrict","transclude","link","element","attr","networkEvents","network","$watch","destroy","forEach","callback","event","String","onload","isFunction","$watchCollection","setOptions","factory"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAOA,kB;;AAEHC,4B,kBAAAA,gB;;AAEGC,mB;;AAEHC,mB,mBAAAA,O;AAASC,mB,mBAAAA,O;;;;;;;;;;;;;;;;;;;;;AAGTC,iB,GAAQ,E;AACRC,iB,GAAQ,E;;sDACCC,S;;;AACT,mCAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,UAA/B,EAA2CC,KAA3C,EAAkD;AAAA;;AAAA,sIACxCH,MADwC,EAChCC,SADgC;;AAE9C,0BAAKG,SAAL,GAAiBF,UAAjB;AACA,0BAAKG,KAAL,GAAaL,MAAb;AACA,0BAAKM,OAAL,GAAeL,UAAUM,GAAV,CAAc,SAAd,CAAf;AACA,0BAAKC,WAAL,GAAmBP,UAAUM,GAAV,CAAc,aAAd,CAAnB;AACA,0BAAKE,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKC,cAAL,CAAoBC,IAApB,OAAhC;;AAEAf,4BAAQ,IAAIF,OAAJ,CAAYE,KAAZ,CAAR;AACAC,4BAAQ,IAAIH,OAAJ,CAAYG,KAAZ,CAAR;AACA,wBAAIe,OAAO;AACPhB,+BAAOA,KADA;AAEPC,+BAAOA;AAFA,qBAAX;AAIA,wBAAIgB,UAAU;AACVjB,+BAAO;AACHkB,mCAAO,KADJ;AAEHC,mCAAO;AACHC,4CAAY,SADT;AAEHC,wCAAQ;AAFL,6BAFJ;AAMHC,kCAAM;AACFH,uCAAO;AADL;AANH,yBADG;AAWVlB,+BAAO;AACHsB,oCAAQ,GADL;AAEHC,oCAAQ,IAFL;AAGHL,mCAAO;AACHA,uCAAO;AADJ;AAHJ,yBAXG;AAkBVM,gCAAQ;AACJC,wCAAY;AADR;AAlBE,qBAAd;AAsBAvB,2BAAOa,IAAP,GAAcA,IAAd;AACAb,2BAAOc,OAAP,GAAiBA,OAAjB;AArC8C;AAsCjD;;;;mDAEcU,Q,EAAU;AACrB,6BAAKC,MAAL,GAAcD,SAASE,GAAT,CAAa,KAAKC,aAAL,CAAmBf,IAAnB,CAAwB,IAAxB,CAAb,CAAd;AACA,4BAAIgB,YAAY;AACZC,mCAAO;AADK,yBAAhB;AAGA,4BAAIC,YAAY,EAAhB;AACAC,gCAAQC,GAAR,CAAY,KAAKP,MAAjB;AACA,6BAAK,IAAIQ,IAAI,CAAb,EAAgBA,IAAI,KAAKR,MAAL,CAAYL,MAAhC,EAAwCa,GAAxC,EAA6C;AACzCL,wCAAY;AACRC,uCAAO;AADC,6BAAZ;AAGAC,wCAAY,EAAZ;AACA,gCAAI,KAAKL,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,CAAsBC,OAAtB,CAA8B,GAA9B,KAAsC,CAAC,CAA3C,EAA8C;AAC1C,oCAAIC,YAAY,KAAKX,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,CAAsBG,SAAtB,CAAgC,CAAhC,EAAmC,KAAKZ,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,CAAsBd,MAAzD,CAAhB;AACA,oCAAIkB,cAAc,KAAKb,MAAL,CAAYQ,CAAZ,EAAeM,UAAf,CAA0B,KAAKd,MAAL,CAAYQ,CAAZ,EAAeM,UAAf,CAA0BnB,MAA1B,GAAmC,CAA7D,EAAgE,CAAhE,CAAlB;AACAU,4CAAY;AACRU,wCAAIJ,SADI;AAERK,2CAAOH,WAFC;AAGRT,2CAAOO,YAAY,IAAZ,GAAmBE,WAHlB;AAIRI,6CAAS;AAJD,iCAAZ;AAMA,oCAAI,EAAEN,aAAavC,MAAM8C,KAArB,CAAJ,EAAiC;AAC7B9C,0CAAM+C,GAAN,CAAUd,SAAV;AACH,iCAFD,MAEO;AACHjC,0CAAMgD,MAAN,CAAaf,SAAb;AACH;AACJ;AACDC,oCAAQC,GAAR,CAAYlC,KAAZ;AACA,gCAAI,KAAK2B,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,CAAsBC,OAAtB,CAA8B,GAA9B,KAAsC,CAAC,CAA3C,EAA8C;AAC1C,oCAAI,KAAKV,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,CAAsBC,OAAtB,CAA8B,GAA9B,KAAsC,CAAC,CAA3C,EAA8C;AAC1C,yCAAKV,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,GAAwB,KAAKT,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,CAAsBG,SAAtB,CAAgC,CAAhC,EAAmC,KAAKZ,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,CAAsBd,MAAzD,CAAxB;AACA,wCAAI0B,cAAc,CAAlB;AACAf,4CAAQC,GAAR,CAAY,KAAKP,MAAL,CAAYQ,CAAZ,EAAeM,UAAf,CAA0B,KAAKd,MAAL,CAAYQ,CAAZ,EAAeM,UAAf,CAA0BnB,MAA1B,GAAmC,CAA7D,EAAgE,CAAhE,CAAZ;AACC,wCAAI,KAAKK,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,CAAsBC,OAAtB,CAA8B,GAA9B,KAAsC,CAAC,CAA3C,EAA8C;AAC3CW,sDAAc,KAAKrB,MAAL,CAAYsB,SAAS,KAAKtB,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,CAAsBc,KAAtB,CAA4B,GAA5B,EAAiC,CAAjC,CAAT,EAA8C,EAA9C,CAAZ,EAA+DT,UAA/D,CAA0E,KAAKd,MAAL,CAAYQ,CAAZ,EAAeM,UAAf,CAA0BnB,MAA1B,GAAmC,CAA7G,EAAgH,CAAhH,CAAd;AACA,6CAAKK,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,GAAwB,KAAKT,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,CAAsBc,KAAtB,CAA4B,GAA5B,EAAiC,CAAjC,CAAxB;AACAjB,gDAAQC,GAAR,CAAYc,WAAZ;AACH;AACDf,4CAAQC,GAAR,CAAY,KAAKP,MAAL,CAAYQ,CAAZ,EAAeM,UAAf,CAA0B,KAAKd,MAAL,CAAYQ,CAAZ,EAAeM,UAAf,CAA0BnB,MAA1B,GAAmC,CAA7D,EAAgE,CAAhE,IAAmE0B,WAA/E;AACA,wCAAI,KAAKrB,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,CAAsBC,OAAtB,CAA8B,GAA9B,KAAsC,CAAC,CAA3C,EAA8C;AAC1C,6CAAKV,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,GAAwB,KAAKT,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,CAAsBG,SAAtB,CAAgC,CAAhC,EAAmC,KAAKZ,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,CAAsBd,MAAzD,CAAxB;AACAQ,kDAAU,OAAV,IAAqB9B,MAAMS,GAAN,CAAU,KAAKkB,MAAL,CAAYQ,CAAZ,EAAeC,MAAzB,EAAiCL,KAAjC,GAAyC,KAAzC,IAAkD,KAAKJ,MAAL,CAAYQ,CAAZ,EAAeM,UAAf,CAA0B,KAAKd,MAAL,CAAYQ,CAAZ,EAAeM,UAAf,CAA0BnB,MAA1B,GAAmC,CAA7D,EAAgE,CAAhE,IAAmE0B,WAArH,CAArB;AACH,qCAHD,MAGO;AACHlB,kDAAU,OAAV,IAAqB,KAAKH,MAAL,CAAYQ,CAAZ,EAAeM,UAAf,CAA0B,KAAKd,MAAL,CAAYQ,CAAZ,EAAeM,UAAf,CAA0BnB,MAA1B,GAAmC,CAA7D,EAAgE,CAAhE,IAAmE0B,WAAxF;AACH;AACJ;AACDlB,0CAAU,IAAV,IAAkB,KAAKH,MAAL,CAAYQ,CAAZ,EAAeC,MAAjC;AACAN,0CAAU,MAAV,IAAoB,KAAKH,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,CAAsBc,KAAtB,CAA4B,GAA5B,EAAiC,CAAjC,CAApB;AACApB,0CAAU,OAAV,IAAqB;AACjBZ,2CAAO,QADU;AAEjBiC,6CAAS,KAAKxB,MAAL,CAAYQ,CAAZ,EAAeM,UAAf,CAA0B,KAAKd,MAAL,CAAYQ,CAAZ,EAAeM,UAAf,CAA0BnB,MAA1B,GAAmC,CAA7D,EAAgE,CAAhE,IAAqE;AAF7D,iCAArB;AAIAQ,0CAAU,IAAV,IAAkB,KAAKH,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,CAAsBc,KAAtB,CAA4B,GAA5B,EAAiC,CAAjC,CAAlB;AACApB,0CAAU,SAAV,IAAuB,CAAvB;AACA,oCAAI,EAAE,KAAKH,MAAL,CAAYQ,CAAZ,EAAeC,MAAf,IAAyBpC,MAAM6C,KAAjC,CAAJ,EAA6C;AACzC7C,0CAAM8C,GAAN,CAAUhB,SAAV;AACH,iCAFD,MAEO;AACH9B,0CAAM+C,MAAN,CAAajB,SAAb;AACH;AAEJ;AAEJ;AACD,6BAAK,IAAIsB,IAAT,IAAiBrD,MAAM8C,KAAvB,EAA8B;AAC1B,gCAAI,CAAE9C,MAAM8C,KAAN,CAAYO,IAAZ,EAAkBR,OAAxB,EAAkC;AAC9B7C,sCAAMsD,MAAN,CAAa;AACTX,wCAAIU;AADK,iCAAb;AAGH,6BAJD,MAIO;AACHrD,sCAAM8C,KAAN,CAAYO,IAAZ,EAAkBR,OAAlB,GAA4B,CAAC7C,MAAM8C,KAAN,CAAYO,IAAZ,EAAkBR,OAA/C;AACH;AACJ;AACD,6BAAK,IAAIU,IAAT,IAAiBtD,MAAM6C,KAAvB,EAA8B;AAC1B,gCAAI,CAAE7C,MAAM6C,KAAN,CAAYS,IAAZ,EAAkBV,OAAxB,EAAkC;AAC9B5C,sCAAMqD,MAAN,CAAa;AACTX,wCAAIY;AADK,iCAAb;AAGH,6BAJD,MAIO;AACHtD,sCAAM6C,KAAN,CAAYS,IAAZ,EAAkBV,OAAlB,GAA4B,CAAC5C,MAAM6C,KAAN,CAAYS,IAAZ,EAAkBV,OAA/C;AACH;AACJ;AAEJ;;;kDACaW,U,EAAY;AACtB,4BAAI5B,SAAS4B,UAAb;AACA,+BAAO5B,MAAP;AACH;;;;cA/H0BhC,gB;;;;AAqI/BM,sBAAUuD,WAAV,GAAwB,aAAxB;;AAEA5D,oBAAQ6D,MAAR,CAAe,oBAAf,EACKC,SADL,CACe,YADf,EAC6B,YAAW;AAChC,uBAAO;AACHC,8BAAU,IADP;AAEHC,gCAAY,KAFT;AAGHrD,2BAAO;AACHQ,8BAAM,GADH;AAEHC,iCAAS,GAFN;AAGHL,gCAAQ;AAHL,qBAHJ;AAQHkD,0BAAM,cAAStD,KAAT,EAAgBuD,OAAhB,EAAyBC,IAAzB,EAA+B;AACjC,4BAAIC,gBAAgB,CAChB,OADgB,EAEhB,aAFgB,EAGhB,WAHgB,EAIhB,MAJgB,EAKhB,SALgB,EAMhB,YANgB,EAOhB,YAPgB,EAQhB,cARgB,EAShB,cATgB,EAUhB,WAVgB,EAWhB,UAXgB,EAYhB,SAZgB,EAahB,WAbgB,EAchB,UAdgB,EAehB,MAfgB,EAgBhB,WAhBgB,EAiBhB,WAjBgB,EAkBhB,kBAlBgB,EAmBhB,uBAnBgB,EAoBhB,6BApBgB,EAqBhB,YArBgB,EAsBhB,QAtBgB,EAuBhB,YAvBgB,EAwBhB,eAxBgB,EAyBhB,cAzBgB,EA0BhB,mBA1BgB,CAApB;;AA8BA,4BAAIC,UAAU,IAAd;;AAEA1D,8BAAM2D,MAAN,CAAa,MAAb,EAAqB,YAAW;AAC5B;AACA,gCAAI3D,MAAMQ,IAAN,IAAc,IAAlB,EAAwB;AACpB;AACH;;AAED;AACA;AACA,gCAAIkD,WAAW,IAAf,EAAqB;AACjBA,wCAAQE,OAAR;AACH;;AAED;AACAF,sCAAU,IAAInE,OAAJ,CAAYgE,QAAQ,CAAR,CAAZ,EAAwBvD,MAAMQ,IAA9B,EAAoCR,MAAMS,OAA1C,CAAV;;AAEA;AACApB,oCAAQwE,OAAR,CAAgB7D,MAAMI,MAAtB,EAA8B,UAAS0D,QAAT,EAAmBC,KAAnB,EAA0B;AACpD,oCAAIN,cAAc3B,OAAd,CAAsBkC,OAAOD,KAAP,CAAtB,KAAwC,CAA5C,EAA+C;AAC3CL,4CAAQrD,EAAR,CAAW0D,KAAX,EAAkBD,QAAlB;AACH;AACJ,6BAJD;;AAMA;AACA,gCAAI9D,MAAMI,MAAN,IAAgB,IAAhB,IAAwBJ,MAAMI,MAAN,CAAa6D,MAAb,IAAuB,IAA/C,IACA5E,QAAQ6E,UAAR,CAAmBlE,MAAMI,MAAN,CAAa6D,MAAhC,CADJ,EAC6C;AACzCjE,sCAAMI,MAAN,CAAa6D,MAAb,CAAoBP,OAApB;AACH;AACJ,yBA3BD;;AA6BA1D,8BAAMmE,gBAAN,CAAuB,SAAvB,EAAkC,UAAS1D,OAAT,EAAkB;AAChD,gCAAIiD,WAAW,IAAf,EAAqB;AACjB;AACH;AACDA,oCAAQU,UAAR,CAAmB3D,OAAnB;AACH,yBALD;AAMH;AA5EE,iBAAP;AA8EH,aAhFL;AAiFApB,oBAAQ6D,MAAR,CAAe,kBAAf,EACKmB,OADL,CACa,YADb,EAC2B,YAAW;AAC9B;;AACA,uBAAO,UAAS7D,IAAT,EAAeC,OAAf,EAAwB;AAC3B;AACA,2BAAO,IAAInB,OAAJ,CAAYkB,IAAZ,EAAkBC,OAAlB,CAAP;AACH,iBAHD;AAIH,aAPL;;iCAUIf,S","file":"module.js","sourcesContent":["import config from 'app/core/config';\nimport {\n    MetricsPanelCtrl\n} from 'app/plugins/sdk';\nimport angular from 'angular';\nimport {\n    DataSet, Network\n} from './external/vis.min';\n\nvar nodes = [];\nvar edges = [];\nexport class GraphCtrl extends MetricsPanelCtrl {\n    constructor($scope, $injector, $rootScope, $http) {\n        super($scope, $injector);\n        this.rootScope = $rootScope;\n        this.scope = $scope;\n        this.timeSrv = $injector.get('timeSrv');\n        this.templateSrv = $injector.get('templateSrv');\n        this.events.on('data-received', this.onDataReceived.bind(this));\n\n        nodes = new DataSet(nodes);\n        edges = new DataSet(edges);\n        var data = {\n            nodes: nodes,\n            edges: edges\n        };\n        var options = {\n            nodes: {\n                shape: 'dot',\n                color: {\n                    background: \"#ffd800\",\n                    border: \"#ff6400\"\n                },\n                font: {\n                    color: \"#fff\"\n                }\n            },\n            edges: {\n                length: 400,\n                arrows: 'to',\n                color: {\n                    color: '#ff6400'\n                }\n            },\n            layout: {\n                randomSeed: 528861\n            }\n        };\n        $scope.data = data;\n        $scope.options = options;\n    }\n\n    onDataReceived(dataList) {\n        this.series = dataList.map(this.seriesHandler.bind(this));\n        var data_edge = {\n            label: \"\"\n        };\n        var data_node = {};\n        console.log(this.series);\n        for (var i = 0; i < this.series.length; i++) {\n            data_edge = {\n                label: \"\"\n            };\n            data_node = {};\n            if (this.series[i].target.indexOf(\"#\") != -1) {\n                var target_id = this.series[i].target.substring(1, this.series[i].target.length);\n                var query_value = this.series[i].datapoints[this.series[i].datapoints.length - 1][0];\n                data_node = {\n                    id: target_id,\n                    value: query_value,\n                    label: target_id + \"\\n\" + query_value,\n                    updated: 1\n                }\n                if (!(target_id in nodes._data)) {\n                    nodes.add(data_node);\n                } else {\n                    nodes.update(data_node);\n                }\n            }\n            console.log(edges);\n            if (this.series[i].target.indexOf(\"=\") != -1) {\n                if (this.series[i].target.indexOf(\"*\") != -1) {\n                    this.series[i].target = this.series[i].target.substring(1, this.series[i].target.length)\n                    var subtraction = 0;\n                    console.log(this.series[i].datapoints[this.series[i].datapoints.length - 1][0]);    \n                     if (this.series[i].target.indexOf(\"-\") != -1) {\n                        subtraction = this.series[parseInt(this.series[i].target.split(\"-\")[1], 10)].datapoints[this.series[i].datapoints.length - 1][0];\n                        this.series[i].target = this.series[i].target.split(\"-\")[0];\n                        console.log(subtraction);\n                    }\n                    console.log(this.series[i].datapoints[this.series[i].datapoints.length - 1][0]-subtraction);\n                    if (this.series[i].target.indexOf(\"+\") != -1) {\n                        this.series[i].target = this.series[i].target.substring(1, this.series[i].target.length);\n                        data_edge['label'] = edges.get(this.series[i].target).label + \" / \" + (this.series[i].datapoints[this.series[i].datapoints.length - 1][0]-subtraction);\n                    } else {\n                        data_edge['label'] = this.series[i].datapoints[this.series[i].datapoints.length - 1][0]-subtraction;\n                    }\n                }\n                data_edge['id'] = this.series[i].target;\n                data_edge['from'] = this.series[i].target.split(\"=\")[0];\n                data_edge['color'] = {\n                    color: '5a910a',\n                    opacity: this.series[i].datapoints[this.series[i].datapoints.length - 1][0] / 100\n                };\n                data_edge['to'] = this.series[i].target.split(\"=\")[1];\n                data_edge['updated'] = 1;\n                if (!(this.series[i].target in edges._data)) {\n                    edges.add(data_edge);\n                } else {\n                    edges.update(data_edge);\n                }\n\n            }\n\n        }\n        for (var node in nodes._data) {\n            if (!(nodes._data[node].updated)) {\n                nodes.remove({\n                    id: node\n                });\n            } else {\n                nodes._data[node].updated = !nodes._data[node].updated;\n            }\n        }\n        for (var edge in edges._data) {\n            if (!(edges._data[edge].updated)) {\n                edges.remove({\n                    id: edge\n                });\n            } else {\n                edges._data[edge].updated = !edges._data[edge].updated;\n            }\n        }\n\n    }\n    seriesHandler(seriesData) {\n        var series = seriesData;\n        return series;\n    }\n\n}\n\n\n\nGraphCtrl.templateUrl = 'module.html';\n\nangular.module('grafana.directives')\n    .directive('visNetwork', function() {\n        return {\n            restrict: 'EA',\n            transclude: false,\n            scope: {\n                data: '=',\n                options: '=',\n                events: '='\n            },\n            link: function(scope, element, attr) {\n                var networkEvents = [\n                    'click',\n                    'doubleClick',\n                    'oncontext',\n                    'hold',\n                    'release',\n                    'selectNode',\n                    'selectEdge',\n                    'deselectNode',\n                    'deselectEdge',\n                    'dragStart',\n                    'dragging',\n                    'dragEnd',\n                    'hoverNode',\n                    'blurNode',\n                    'zoom',\n                    'showPopup',\n                    'hidePopup',\n                    'startStabilizing',\n                    'stabilizationProgress',\n                    'stabilizationIterationsDone',\n                    'stabilized',\n                    'resize',\n                    'initRedraw',\n                    'beforeDrawing',\n                    'afterDrawing',\n                    'animationFinished'\n\n                ];\n\n                var network = null;\n\n                scope.$watch('data', function() {\n                    // Sanity check\n                    if (scope.data == null) {\n                        return;\n                    }\n\n                    // If we've actually changed the data set, then recreate the graph\n                    // We can always update the data by adding more data to the existing data set\n                    if (network != null) {\n                        network.destroy();\n                    }\n\n                    // Create the graph2d object\n                    network = new Network(element[0], scope.data, scope.options);\n\n                    // Attach an event handler if defined\n                    angular.forEach(scope.events, function(callback, event) {\n                        if (networkEvents.indexOf(String(event)) >= 0) {\n                            network.on(event, callback);\n                        }\n                    });\n\n                    // onLoad callback\n                    if (scope.events != null && scope.events.onload != null &&\n                        angular.isFunction(scope.events.onload)) {\n                        scope.events.onload(network);\n                    }\n                });\n\n                scope.$watchCollection('options', function(options) {\n                    if (network == null) {\n                        return;\n                    }\n                    network.setOptions(options);\n                });\n            }\n        };\n    });\nangular.module('grafana.services')\n    .factory('VisDataSet', function() {\n        'use strict';\n        return function(data, options) {\n            // Create the new dataSets\n            return new DataSet(data, options);\n        };\n    })\n\nexport {\n    GraphCtrl as PanelCtrl\n};"]}